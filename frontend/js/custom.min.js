/*! frontend 2021-08-17 */

$(document).ready(function(){$.ajax({url:"http://192.168.33.10:3000/allProducts",type:"GET",datatype:"json",success:function(e){console.log(e);for(var r=0;r<e.length;r++)document.getElementById("result").innerHTML+=`<div class="col-6">${e[r].name}</div>${e[r].price}`},error:function(){}});let l="http://192.168.33.10:3000";$.ajax({url:"config.json",type:"GET",dataType:"json",success:function(e){console.log(e),l=`${config.SERVER_URL}:${config.SERVER_PORT}`,console.log(l)},error:function(e){console.log("ERROR"),console.log(e)}}),$("#registerBtn").click(function(){event.preventDefault();var e=$("#regUsername").val(),r=$("#regEmail").val(),o=$("#regPassword").val();console.log(e,r,o),""==e||""==r||""==o?alert("Please enter all details"):$.ajax({url:`${l}/registerUser`,type:"POST",data:{username:e,email:r,password:o},success:function(e){console.log(e),"Username taken already. Please try another name"==e?alert("Please login to manipulate the products data"):(alert("username take already. Please try another name"),$("#r-username").val(""),$("#r-email").val(""),$("#r-password").val(""))},error:function(){console.log("error cannot call api")}})}),$("#loginBtn").click(function(){event.preventDefault();var e=$("#username").val(),r=$("#password").val();console.log(e,r),""==e||""==r?alert("Please enter all details"):$.ajax({url:`${l}/loginUsers`,type:"POST",data:{username:e,password:r},success:function(e){"User not found. Please register"==e?alert("User not found. Please enter correct data or register as new user"):"not authorized"==e?(alert("Please try with correct details"),$("#username").val(""),$("#password").val("")):(sessionStorage.setItem("userID",e._id),sessionStorage.setItem("username",e.username),sessionStorage.setItem("userEmail",e.email),console.log(sessionStorage))},error:function(){console.log("error: cannot call api")}})}),$("#logoutBtn").click(function(){sessionStorage.clear(),console.log(sessionStorage)}),$("#addProduct").click(function(){event.preventDefault();var e=$("#prodName").val(),r=$("#prodPrice").val(),o=$("#prodImageUrl").val(),a=sessionStorage.getItem("userID");console.log(a),console.log(e,r,o),""==e||""==r||""==a?alert("Please emter all details"):$.ajax({url:`${l}/addProduct`,type:"POST",data:{name:e,price:r,image_url:o,user_id:a},success:function(e){alert("product added")},error:function(){console.log("error: cannot call api")}})}),$("#updateProduct").click(function(){event.preventDefault();var e=$("#productId").val(),r=$("#productName").val(),o=$("#productPrice").val(),a=$("#imageurl").val(),t=sessionStorage.getItem("userID");console.log(e,r,o,a,t),""==e?alert("Please enter product id for updating"):$.ajax({url:`${l}/updateProduct/${e}`,type:"PATCH",data:{name:r,price:o,image_url:a,user_id:t},success:function(e){console.log(e),"401 error: user has no permission to update"==e?alert("401 error: user has no permission to update"):alert("updated"),$("#productId").val(""),$("#productName").val(""),$("#productPrice").val(""),$("#imageurl").val("")},error:function(){console.log("error:cannot call api")}})}),$("#deleteProduct").click(function(){var e;event.preventDefault(),sessionStorage.userID?(e=$("#delProductId").val(),console.log(e),""==e?alert("Please enter the product id to delete the product"):$.ajax({url:`${l}/deleteProduct/${e}`,type:"DELETE",data:{user_id:sessionStorage.userID},success:function(e){console.log(e),"deleted"==e?(alert("deleted"),$("#delProductId").val("")):alert("Enter a valid id")},error:function(){console.log("error: cannot call api")}})):alert("401 permission denied")})});